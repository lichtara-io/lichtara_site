<!-- ==============================================
     BLOCO CANALIZADO FINAL: PORTAL CÓSMICO VIVO
================================================= -->

<section id="portal-cosmico" style="position:relative;width:100%;height:100vh;overflow:hidden;background:#000;">

  <!-- Texto central / boas-vindas -->
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);color:white;text-align:center;z-index:10;">
    <h1 style="font-size:3rem;">Bem-vindo ao Lichtara</h1>
    <p style="font-size:1.5rem;">Explore o portal interdimensional</p>
  </div>

  <!-- LAYERS -->
  <canvas id="sky-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;"></canvas>
  <canvas id="particles-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;"></canvas>
  <canvas id="comet-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:3;"></canvas>
  <canvas id="aurora-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;pointer-events:none;"></canvas>
  <canvas id="trail-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:5;"></canvas>
  <canvas id="guidestar-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:6;"></canvas>
  <canvas id="constellation-layer" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:7;"></canvas>

</section>

<script>
  // Inicialização das camadas
  const layers = ['sky','particles','comet','aurora','trail','guidestar','constellation'];
  const canvases = {};
  const ctxs = {};
  layers.forEach(id=>{
    canvases[id] = document.getElementById(`${id}-layer`);
    ctxs[id] = canvases[id].getContext('2d');
    canvases[id].width = window.innerWidth;
    canvases[id].height = window.innerHeight;
  });

  // ======================
  // CÉU ESTRELADO
  // ======================
  const stars = [];
  for(let i=0;i<250;i++) stars.push({x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight, r:Math.random()*1.5+0.5});
  function drawSky(){
    const ctx = ctxs.sky;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    stars.forEach(s=>{
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fillStyle='white';
      ctx.fill();
    });
  }

  // ======================
  // PARTICULAS FLUTUANTES
  // ======================
  const particles = [];
  for(let i=0;i<120;i++){
    particles.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,r:Math.random()*2+1,dx:(Math.random()-0.5)*0.4,dy:(Math.random()-0.5)*0.4});
  }
  function drawParticles(){
    const ctx = ctxs.particles;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    particles.forEach(p=>{
      p.x+=p.dx; p.y+=p.dy;
      if(p.x<0)p.x=window.innerWidth; if(p.x>window.innerWidth)p.x=0;
      if(p.y<0)p.y=window.innerHeight; if(p.y>window.innerHeight)p.y=0;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle='rgba(255,255,255,0.6)';
      ctx.fill();
    });
  }

  // ======================
  // COMETA COM RASTRO LUMINOSO
  // ======================
  const comet = {x:-100,y:100,dx:5,dy:1,r:5,trail:[]};
  function drawComet(){
    const ctx = ctxs.comet;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    // Adiciona posição atual no trail
    comet.trail.push({x:comet.x,y:comet.y,opacity:1});
    if(comet.trail.length>30) comet.trail.shift();

    // Desenha trail
    comet.trail.forEach(t=>{
      ctx.beginPath();
      ctx.arc(t.x,t.y,comet.r,0,Math.PI*2);
      ctx.fillStyle=`rgba(255,255,255,${t.opacity})`;
      ctx.fill();
      t.opacity -= 0.03;
    });

    // Desenha cometa
    ctx.beginPath();
    ctx.arc(comet.x,comet.y,comet.r,0,Math.PI*2);
    ctx.fillStyle='white';
    ctx.fill();

    comet.x+=comet.dx; comet.y+=comet.dy;
    if(comet.x>window.innerWidth){comet.x=-50; comet.y=Math.random()*window.innerHeight/2;}
  }

  // ======================
  // AURORA INTERATIVA
  // ======================
  const auroraImg = new Image();
  auroraImg.src='aurora.gif'; // seu GIF real no repositório
  const auroraCanvas = canvases.aurora;
  const auroraCtx = ctxs.aurora;
  const auroraOffset = {x:0,y:0};
  const auroraColor = {r:0,g:255,b:128};

  window.addEventListener('mousemove',e=>{
    auroraOffset.x = (e.clientX - window.innerWidth/2) * 0.02;
    auroraOffset.y = (e.clientY - window.innerHeight/2) * 0.02;
    auroraColor.r = Math.min(255, Math.max(0, (e.clientX/window.innerWidth)*255));
    auroraColor.g = Math.min(255, Math.max(0, 255 - (e.clientY/window.innerHeight)*255));
    auroraColor.b = Math.min(255, Math.max(0, 128 + (e.clientY/window.innerHeight)*127));
  });

  function drawAurora(){
    auroraCtx.clearRect(0,0,window.innerWidth,window.innerHeight);
    if(auroraImg.complete){
      auroraCtx.save();
      auroraCtx.globalAlpha = 0.5;
      auroraCtx.filter = `hue-rotate(${auroraColor.r}deg)`;
      auroraCtx.drawImage(auroraImg, auroraOffset.x, auroraOffset.y, window.innerWidth*1.05, window.innerHeight*1.05);
      auroraCtx.restore();
    }
  }

  // ======================
  // RASTRO DO MOUSE MÁGICO
  // ======================
  const trailParticles = [];
  const mouse = {x:0,y:0};
  window.addEventListener('mousemove',e=>{mouse.x=e.clientX; mouse.y=e.clientY;});

  function drawTrail(){
    const ctx = ctxs.trail;
    ctx.fillStyle='rgba(0,0,0,0.05)';
    ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
    trailParticles.push({x:mouse.x,y:mouse.y,r:Math.random()*4+2});
    if(trailParticles.length>60) trailParticles.shift();
    trailParticles.forEach(p=>{
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle='rgba(255,255,255,0.8)';
      ctx.fill();
    });
  }

  // ======================
  // ESTRELA-GUIA
  // ======================
  const guideStar = {x:window.innerWidth/2,y:window.innerHeight/4,r:6};
  function drawGuideStar(){
    const ctx = ctxs.guidestar;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    ctx.beginPath();
    ctx.arc(guideStar.x,guideStar.y,guideStar.r,0,Math.PI*2);
    ctx.fillStyle='yellow';
    ctx.fill();
  }

  // ======================
  // CONSTELAÇÕES INTERATIVAS
  // ======================
  const constellationStars = [];
  for(let i=0;i<50;i++){
    constellationStars.push({
      x:Math.random()*window.innerWidth,
      y:Math.random()*window.innerHeight,
      r:Math.random()*2+1
    });
  }

  function drawConstellations(){
    const ctx = ctxs.constellation;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    constellationStars.forEach(s=>{
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fillStyle='white';
      ctx.fill();
    });
    // conecta estrelas próximas
    for(let i=0;i<constellationStars.length;i++){
      for(let j=i+1;j<constellationStars.length;j++){
        const dx=constellationStars[i].x-constellationStars[j].x;
        const dy=constellationStars[i].y-constellationStars[j].y;
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<100){
          ctx.beginPath();
          ctx.moveTo(constellationStars[i].x,constellationStars[i].y);
          ctx.lineTo(constellationStars[j].x,constellationStars[j].y);
          ctx.strokeStyle='rgba(255,255,255,0.2)';
          ctx.stroke();
        }
      }
    }
  }

  // ======================
  // LOOP PRINCIPAL
  // ======================
  function animate(){
    drawSky();
    drawParticles();
    drawComet();
    drawAurora();
    drawTrail();
    drawGuideStar();
    drawConstellations();
    requestAnimationFrame(animate);
  }
  animate();

  // ======================
  // RESPONSIVIDADE
  // ======================
  window.addEventListener('resize',()=>{
    layers.forEach(id=>{
      canvases[id].width=window.innerWidth;
      canvases[id].height=window.innerHeight;
    });
  });
</script>
